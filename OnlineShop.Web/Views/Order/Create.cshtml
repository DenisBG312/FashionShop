@model OnlineShop.Web.ViewModels.Order.CreateOrderViewModel

@{
    ViewData["Title"] = "Create Order";
}

<h1>Create Order</h1>

<form asp-action="Create" method="post" id="orderForm">
    <div id="productList">
        <div class="order-product">
            <div class="form-group">
                <label>Select Product:</label>
                <select name="OrderProducts[0].ProductId" class="form-control" asp-items="Model.Products"></select>
            </div>
            <div class="form-group">
                <label>Quantity:</label>
                <input name="OrderProducts[0].Quantity" class="form-control" type="number" min="1" required />
                <span asp-validation-for="OrderProducts[0].Quantity" class="text-danger"></span>
            </div>
        </div>
    </div>

    <button type="button" id="add-product" class="btn btn-secondary mt-3">Add Another Product</button>
    <button type="submit" class="btn btn-primary mt-3">Submit Order</button>
</form>

@section Scripts {
    <script>
        let productIndex = 1; // To keep track of the product input fields

        document.getElementById('add-product').addEventListener('click', function () {
            const productList = document.getElementById('productList');
            const newProductDiv = document.createElement('div');
            newProductDiv.classList.add('order-product');

            newProductDiv.innerHTML = `
                <div class="form-group">
                    <label>Select Product:</label>
                    <select name="OrderProducts[${productIndex}].ProductId" class="form-control">
        @foreach (var product in Model.Products)
        {
            <text>
                                    <option value="@product.Value">@product.Text</option>
            </text>
        }
                    </select>
                </div>
                <div class="form-group">
                    <label>Quantity:</label>
                    <input name="OrderProducts[${productIndex}].Quantity" class="form-control" type="number" min="1" required />
                    <span asp-validation-for="OrderProducts[${productIndex}].Quantity" class="text-danger"></span>
                </div>
            `;
            productList.appendChild(newProductDiv);
            productIndex++;
        });
    </script>
}
